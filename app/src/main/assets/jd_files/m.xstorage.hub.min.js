(function(e){var t={};t.init=function(e){var r=true;try{if(!window.localStorage)r=false}catch(e){r=false}if(!r){try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(e){return}}t._permissions=e||[];t._installListener();window.parent.postMessage("cross-storage:ready","*")};t._installListener=function(){var e=t._listener;if(window.addEventListener){window.addEventListener("message",e,false)}else{window.attachEvent("onmessage",e)}};t._listener=function(e){var r,n,o,i,s,a,l;r=e.origin==="null"?"file://":e.origin;if(e.data==="cross-storage:poll"){return window.parent.postMessage("cross-storage:ready",e.origin)}if(e.data==="cross-storage:ready")return;try{o=JSON.parse(e.data)}catch(e){return}if(!o||typeof o.method!=="string"){return}i=o.method.split("cross-storage:")[1];if(!i){return}else if(!t._permitted(r,i)){s="Invalid permissions for "+i}else{try{a=t["_"+i](o.params)}catch(e){s=e.message}}l=JSON.stringify({id:o.id,error:s,result:a});n=r==="file://"?"*":r;window.parent.postMessage(l,n)};t._permitted=function(e,r){var n,o,i,s;n=["get","set","del","clear","getKeys"];if(!t._inArray(r,n)){return false}for(o=0;o<t._permissions.length;o++){i=t._permissions[o];if(!(i.origin instanceof RegExp)||!(i.allow instanceof Array)){continue}s=i.origin.test(e);if(s&&t._inArray(r,i.allow)){return true}}return false};t._set=function(e){window.localStorage.setItem(e.key,e.value)};t._get=function(e){var t,r,n,o;t=window.localStorage;r=[];for(n=0;n<e.keys.length;n++){try{o=t.getItem(e.keys[n])}catch(e){o=null}r.push(o)}return r.length>1?r:r[0]};t._del=function(e){for(var t=0;t<e.keys.length;t++){window.localStorage.removeItem(e.keys[t])}};t._clear=function(){window.localStorage.clear()};t._getKeys=function(e){var t,r,n;n=[];r=window.localStorage.length;for(t=0;t<r;t++){n.push(window.localStorage.key(t))}return n};t._inArray=function(e,t){for(var r=0;r<t.length;r++){if(e===t[r])return true}return false};t._now=function(){if(typeof Date.now==="function"){return Date.now()}return(new Date).getTime()};if(typeof module!=="undefined"&&module.exports){module.exports=t}else if(typeof exports!=="undefined"){exports.CrossStorageHub=t}else if(typeof define==="function"&&define.amd){define([],function(){return t})}else{e.CrossStorageHub=t}})(this);